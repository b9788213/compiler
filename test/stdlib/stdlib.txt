import "stdlib/casting"

fn print(s):
    asm "push rdi"
    asm "call len"
    asm "mov rdx, rax"
    asm "pop rsi"
    asm "mov rax, 1"
    asm "mov rdi, 1"
    asm "syscall"
    asm "jmp .exit"

fn input():
    asm "mov rdi, 4096"
    asm "call alloc"
    asm "mov rsi, rax"
    asm "xor rax, rax"
    asm "xor rdi, rdi"
    asm "mov rdx, 4096"
    asm "syscall"
    asm "mov byte [rsi + rax - 1], 0"
    asm "mov rax, rsi"
    asm "jmp .exit"

fn len(s):
    asm "xor rax, rax"
    asm ".loop:"
    asm "cmp byte [rdi + rax], 0"
    asm "je .exit"
    asm "inc rax"
    asm "jmp .loop"

fn alloc(i):
    asm "mov rsi, rdi"
    asm "mov rax, 9"
    asm "xor rdi, rdi"
    asm "mov rdx, 0x3"
    asm "mov r10, 0x22"
    asm "mov r8, -1"
    asm "mov r9, 0"
    asm "syscall"
    asm "jmp .exit"